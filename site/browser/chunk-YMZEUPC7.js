import{a as F,b as O,c as D,d as k,e as L,f as V,j as W}from"./chunk-BFXV4QD4.js";import{a as T,b as N}from"./chunk-NZYL2M6M.js";import{$a as h,Ba as C,Fa as d,La as l,Ma as e,Na as t,Pa as w,Qa as g,Ra as u,U as S,V as y,Wa as n,Xa as p,Za as x,_a as _,ab as v,eb as A,fb as E,ra as s,sb as b,tb as I,ub as M,vb as P,xa as f}from"./chunk-UNNPGNX6.js";function j(a,o){if(a&1&&(e(0,"p",13),n(1),t()),a&2){let i=u();s(),p(i.status)}}function q(a,o){if(a&1&&(e(0,"article",4)(1,"p",13),n(2),t(),e(3,"h3"),n(4),t(),e(5,"p"),n(6,"Views"),t()()),a&2){let i=o.$implicit;s(2),p(i.page),s(2),p(i.views)}}function G(a,o){if(a&1&&(e(0,"section",0)(1,"div",1)(2,"p",2),n(3,"Stats"),t(),e(4,"h2"),n(5,"Page views"),t()(),e(6,"div",14),d(7,q,7,2,"article",15),t()()),a&2){let i=u();s(7),l("ngForOf",i.stats)}}function z(a,o){if(a&1){let i=w();e(0,"article",4)(1,"p",13),n(2),A(3,"date"),t(),e(4,"h3"),n(5),t(),e(6,"p"),n(7),t(),e(8,"button",17),g("click",function(){let c=S(i).$implicit,m=u(2);return y(m.approve(c.id))}),n(9,"Approve"),t()()}if(a&2){let i=o.$implicit;s(2),x("",E(3,4,i.created_at,"mediumDate")," \xB7 ",i.page),s(3),p(i.author),s(2),p(i.message)}}function H(a,o){if(a&1&&(e(0,"section",0)(1,"div",1)(2,"p",2),n(3,"Moderation"),t(),e(4,"h2"),n(5,"Pending comments"),t()(),e(6,"div",16),d(7,z,10,7,"article",15),t()()),a&2){let i=u();s(7),l("ngForOf",i.comments)}}var B=class a{constructor(o,i){this.auth=o;this.api=i}email="";password="";status="";stats=[];comments=[];hasAccess=!1;async ngOnInit(){await this.refresh()}async login(){this.status="";let o=await this.auth.signIn(this.email,this.password);if(o){this.status=o;return}await this.refresh()}async logout(){await this.auth.signOut(),this.stats=[],this.comments=[],this.hasAccess=!1}async refresh(){try{this.stats=await this.api.getStatsAdmin(),this.comments=await this.api.getCommentsAdmin(),this.hasAccess=!0}catch(o){this.status=o.message||"Login required",this.hasAccess=!1}}async approve(o){this.status="";try{await this.api.approveComment(o),await this.refresh()}catch(i){this.status=i.message||"Approval failed"}}static \u0275fac=function(i){return new(i||a)(f(T),f(N))};static \u0275cmp=C({type:a,selectors:[["app-admin"]],decls:26,vars:5,consts:[[1,"section"],[1,"section-head"],[1,"eyebrow"],[1,"section-lead"],[1,"panel"],[1,"form",3,"submit"],["type","email","name","email",3,"ngModelChange","ngModel"],["type","password","name","password",3,"ngModelChange","ngModel"],[1,"form-actions"],["type","submit",1,"btn","primary"],["type","button",1,"btn","ghost",3,"click"],["class","hint",4,"ngIf"],["class","section",4,"ngIf"],[1,"hint"],[1,"card-grid","three"],["class","panel",4,"ngFor","ngForOf"],[1,"card-grid","two"],["type","button",1,"btn","primary",3,"click"]],template:function(i,r){i&1&&(e(0,"section",0)(1,"div",1)(2,"p",2),n(3,"Admin"),t(),e(4,"h2"),n(5,"Moderation & stats"),t(),e(6,"p",3),n(7,"Login required to manage comments and stats."),t()(),e(8,"article",4)(9,"form",5),g("submit",function(m){return r.login(),m.preventDefault()}),e(10,"label")(11,"span"),n(12,"Email"),t(),e(13,"input",6),v("ngModelChange",function(m){return h(r.email,m)||(r.email=m),m}),t()(),e(14,"label")(15,"span"),n(16,"Password"),t(),e(17,"input",7),v("ngModelChange",function(m){return h(r.password,m)||(r.password=m),m}),t()(),e(18,"div",8)(19,"button",9),n(20,"Login"),t(),e(21,"button",10),g("click",function(){return r.logout()}),n(22,"Logout"),t()(),d(23,j,2,1,"p",11),t()()(),d(24,G,8,1,"section",12)(25,H,8,1,"section",12)),i&2&&(s(13),_("ngModel",r.email),s(4),_("ngModel",r.password),s(6),l("ngIf",r.status),s(),l("ngIf",r.hasAccess),s(),l("ngIf",r.hasAccess))},dependencies:[P,b,I,W,V,F,O,D,L,k,M],encapsulation:2})};export{B as AdminComponent};
