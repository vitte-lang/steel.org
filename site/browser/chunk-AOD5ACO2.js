import{a as A,b as F,c as N,d as O,e as L,f as k,g as R,h as j,i as q,j as G}from"./chunk-BFXV4QD4.js";import{a as P,b as W}from"./chunk-NZYL2M6M.js";import{b as V}from"./chunk-SJYRP2N3.js";import{a as T}from"./chunk-OCKYRLHM.js";import{$a as f,Ba as y,Fa as _,La as g,Ma as e,Na as i,Pa as C,Qa as w,Ra as m,U as c,V as d,Wa as a,Xa as u,Za as b,_a as h,ab as x,eb as E,fb as v,ra as r,sb as M,tb as D,ub as I,vb as B,xa as S}from"./chunk-UNNPGNX6.js";function U(o,s){if(o&1&&(e(0,"p"),a(1),i()),o&2){let t=s.$implicit;r(),u(t)}}function z(o,s){if(o&1&&(e(0,"li"),a(1),i()),o&2){let t=s.$implicit;r(),u(t)}}function H(o,s){if(o&1&&(e(0,"section",1)(1,"div",2)(2,"p",3),a(3),i(),e(4,"h2"),a(5),i(),e(6,"p",4),a(7),i()(),e(8,"article",5),_(9,U,2,1,"p",6),i(),e(10,"article",5)(11,"h3"),a(12,"Key takeaways"),i(),e(13,"ul",7),_(14,z,2,1,"li",6),i()()()),o&2){let t=m();r(3),u(t.t.blog.eyebrow),r(2),u(t.post.title),r(2),u(t.post.date),r(2),g("ngForOf",t.post.body),r(5),g("ngForOf",t.post.takeaways)}}function J(o,s){if(o&1&&(e(0,"p",15),a(1),i()),o&2){let t=m(2);r(),u(t.authStatus)}}function Q(o,s){if(o&1){let t=C();e(0,"section",1)(1,"div",2)(2,"p",3),a(3,"Login"),i(),e(4,"h2"),a(5,"Author access"),i(),e(6,"p",4),a(7,"Sign in to post comments and send messages."),i()(),e(8,"article",5)(9,"form",8),w("submit",function(n){return c(t),m().signIn(),d(n.preventDefault())}),e(10,"label")(11,"span"),a(12,"Email"),i(),e(13,"input",9),x("ngModelChange",function(n){c(t);let l=m();return f(l.authEmail,n)||(l.authEmail=n),d(n)}),i()(),e(14,"label")(15,"span"),a(16,"Password"),i(),e(17,"input",10),x("ngModelChange",function(n){c(t);let l=m();return f(l.authPassword,n)||(l.authPassword=n),d(n)}),i()(),e(18,"div",11)(19,"button",12),a(20,"Sign in"),i(),e(21,"button",13),w("click",function(){c(t);let n=m();return d(n.signOut())}),a(22,"Sign out"),i()(),_(23,J,2,1,"p",14),i()()()}if(o&2){let t=m();r(13),h("ngModel",t.authEmail),r(4),h("ngModel",t.authPassword),r(6),g("ngIf",t.authStatus)}}function X(o,s){if(o&1&&(e(0,"article",5)(1,"p",15),a(2),E(3,"date"),i(),e(4,"h3"),a(5),i(),e(6,"p"),a(7),i()()),o&2){let t=s.$implicit;r(2),b("",v(3,4,t.created_at,"mediumDate")," \xB7 ",t.rating||"-","/5"),r(3),u(t.author),r(2),u(t.message)}}function Y(o,s){if(o&1&&(e(0,"p",15),a(1),i()),o&2){let t=m(2);r(),u(t.status)}}function Z(o,s){if(o&1){let t=C();e(0,"section",1)(1,"div",2)(2,"p",3),a(3,"Comments"),i(),e(4,"h2"),a(5,"Reader notes"),i(),e(6,"p",4),a(7,"Public comments appear once approved."),i()(),e(8,"div",16),_(9,X,8,7,"article",17),i(),e(10,"article",5)(11,"h3"),a(12,"Add a comment"),i(),e(13,"p",15),a(14,"Login required to submit."),i(),e(15,"form",8),w("submit",function(n){return c(t),m().submitComment(),d(n.preventDefault())}),e(16,"label")(17,"span"),a(18,"Name"),i(),e(19,"input",18),x("ngModelChange",function(n){c(t);let l=m();return f(l.form.author,n)||(l.form.author=n),d(n)}),i()(),e(20,"label",19)(21,"span"),a(22,"Website"),i(),e(23,"input",20),x("ngModelChange",function(n){c(t);let l=m();return f(l.form.website,n)||(l.form.website=n),d(n)}),i()(),e(24,"label")(25,"span"),a(26,"Rating (1-5)"),i(),e(27,"input",21),x("ngModelChange",function(n){c(t);let l=m();return f(l.form.rating,n)||(l.form.rating=n),d(n)}),i()(),e(28,"label")(29,"span"),a(30,"Message"),i(),e(31,"textarea",22),x("ngModelChange",function(n){c(t);let l=m();return f(l.form.message,n)||(l.form.message=n),d(n)}),i()(),e(32,"button",12),a(33,"Submit"),i(),_(34,Y,2,1,"p",14),i()()()}if(o&2){let t=m();r(9),g("ngForOf",t.comments),r(10),h("ngModel",t.form.author),r(4),h("ngModel",t.form.website),r(4),h("ngModel",t.form.rating),r(4),h("ngModel",t.form.message),r(3),g("ngIf",t.status)}}var K=class o{constructor(s,t,p,n){this.route=s;this.state=t;this.api=p;this.auth=n}post;comments=[];status="";authStatus="";authEmail="";authPassword="";form={author:"",rating:5,message:"",website:"",ts:Date.now()};email=null;get t(){return this.state.t()}async ngOnInit(){let s=this.route.snapshot.paramMap.get("slug");this.post=this.t.blog.posts.find(t=>t.slug===s),await this.refreshAuth(),this.post&&(await this.loadComments(this.post.slug),await this.api.trackPage(`/blog/${this.post.slug}`))}async refreshAuth(){this.email=await this.auth.getUserEmail(),this.form.author=this.email||""}async signIn(){this.authStatus="";let s=await this.auth.signIn(this.authEmail,this.authPassword);if(s){this.authStatus=s;return}await this.refreshAuth(),this.authStatus="Signed in."}async signOut(){await this.auth.signOut(),this.email=null,this.authStatus="Signed out."}async loadComments(s){try{this.comments=await this.api.getComments(s)}catch(t){this.status=t.message||"Failed to load comments"}}async submitComment(){if(this.post){this.status="";try{await this.api.postComment({page:this.post.slug,author:this.form.author||"user",rating:this.form.rating||null,message:this.form.message,email:this.email||void 0,meta:{hp:this.form.website,ts:this.form.ts}}),this.form.message="",this.form.ts=Date.now(),await this.loadComments(this.post.slug),this.status="Comment submitted for approval."}catch(s){this.status=s.message||"Failed to submit comment"}}}static \u0275fac=function(t){return new(t||o)(S(V),S(T),S(W),S(P))};static \u0275cmp=y({type:o,selectors:[["app-blog-detail"]],decls:3,vars:3,consts:[["class","section",4,"ngIf"],[1,"section"],[1,"section-head"],[1,"eyebrow"],[1,"section-lead"],[1,"panel"],[4,"ngFor","ngForOf"],[1,"list"],[1,"form",3,"submit"],["type","email","name","authEmail",3,"ngModelChange","ngModel"],["type","password","name","authPassword",3,"ngModelChange","ngModel"],[1,"form-actions"],["type","submit",1,"btn","primary"],["type","button",1,"btn","ghost",3,"click"],["class","hint",4,"ngIf"],[1,"hint"],[1,"card-grid","two"],["class","panel",4,"ngFor","ngForOf"],["type","text","name","author",3,"ngModelChange","ngModel"],[1,"honeypot"],["type","text","name","website","autocomplete","off",3,"ngModelChange","ngModel"],["type","number","min","1","max","5","name","rating",3,"ngModelChange","ngModel"],["rows","4","name","message",3,"ngModelChange","ngModel"]],template:function(t,p){t&1&&_(0,H,15,5,"section",0)(1,Q,24,3,"section",0)(2,Z,35,6,"section",0),t&2&&(g("ngIf",p.post),r(),g("ngIf",p.post),r(),g("ngIf",p.post))},dependencies:[B,M,D,G,k,A,R,F,N,q,j,L,O,I],encapsulation:2})};export{K as BlogDetailComponent};
