import{a as O,b as k,c as F,d as L,e as N,f as j,g as R,h as J,i as z,j as G}from"./chunk-WUIIHW2R.js";import{a as V,b as W}from"./chunk-UBY4PNWH.js";import{a as B}from"./chunk-5CWPOJNP.js";import{a as A}from"./chunk-7ZHFCJE7.js";import"./chunk-64RMFKBP.js";import{a as T}from"./chunk-JFSI74IK.js";import{$a as o,Ab as I,Bb as D,Cb as P,Da as y,Ha as h,Na as g,Oa as e,Pa as i,Ra as C,Sa as _,Ta as m,U as c,V as d,ab as u,cb as b,eb as f,fb as x,gb as S,kb as v,lb as E,ta as r,za as w,zb as M}from"./chunk-6FHNHJOP.js";function q(s,a){if(s&1&&(e(0,"p"),o(1),i()),s&2){let t=a.$implicit;r(),u(t)}}function H(s,a){if(s&1&&(e(0,"li"),o(1),i()),s&2){let t=a.$implicit;r(),u(t)}}function K(s,a){if(s&1&&(e(0,"section",1)(1,"div",2)(2,"p",3),o(3),i(),e(4,"h2"),o(5),i(),e(6,"p",4),o(7),i()(),e(8,"article",5),h(9,q,2,1,"p",6),i(),e(10,"article",5)(11,"h3"),o(12,"Key takeaways"),i(),e(13,"ul",7),h(14,H,2,1,"li",6),i()()()),s&2){let t=m();r(3),u(t.t.blog.eyebrow),r(2),u(t.post.title),r(2),u(t.post.date),r(2),g("ngForOf",t.post.body),r(5),g("ngForOf",t.post.takeaways)}}function Q(s,a){if(s&1&&(e(0,"p",14),o(1),i()),s&2){let t=m(2);r(),u(t.authStatus)}}function X(s,a){if(s&1){let t=C();e(0,"section",1)(1,"div",2)(2,"p",3),o(3,"Login"),i(),e(4,"h2"),o(5,"Author access"),i(),e(6,"p",4),o(7,"Sign in to post comments and send messages."),i()(),e(8,"article",5)(9,"form",8),_("submit",function(n){return c(t),m().signIn(),d(n.preventDefault())}),e(10,"label")(11,"span"),o(12,"Email"),i(),e(13,"input",9),S("ngModelChange",function(n){c(t);let l=m();return x(l.authEmail,n)||(l.authEmail=n),d(n)}),i()(),e(14,"label")(15,"span"),o(16,"Password"),i(),e(17,"input",10),S("ngModelChange",function(n){c(t);let l=m();return x(l.authPassword,n)||(l.authPassword=n),d(n)}),i()(),e(18,"div",11)(19,"button",12),o(20,"Sign in"),i(),e(21,"button",13),_("click",function(){c(t);let n=m();return d(n.signOut())}),o(22,"Sign out"),i()(),e(23,"p",14),o(24,"Or continue with"),i(),e(25,"div",11)(26,"button",13),_("click",function(){c(t);let n=m();return d(n.signInWithProvider("github"))}),o(27,"GitHub"),i(),e(28,"button",13),_("click",function(){c(t);let n=m();return d(n.signInWithProvider("google"))}),o(29,"Google"),i(),e(30,"button",13),_("click",function(){c(t);let n=m();return d(n.signInWithProvider("azure"))}),o(31,"Microsoft"),i()(),h(32,Q,2,1,"p",15),i()()()}if(s&2){let t=m();r(13),f("ngModel",t.authEmail),r(4),f("ngModel",t.authPassword),r(15),g("ngIf",t.authStatus)}}function Y(s,a){if(s&1&&(e(0,"article",5)(1,"p",14),o(2),v(3,"date"),i(),e(4,"h3"),o(5),i(),e(6,"p"),o(7),i()()),s&2){let t=a.$implicit;r(2),b("",E(3,4,t.created_at,"mediumDate")," \xB7 ",t.rating||"-","/5"),r(3),u(t.author),r(2),u(t.message)}}function Z(s,a){if(s&1&&(e(0,"p",14),o(1),i()),s&2){let t=m(2);r(),u(t.status)}}function $(s,a){if(s&1){let t=C();e(0,"section",1)(1,"div",2)(2,"p",3),o(3,"Comments"),i(),e(4,"h2"),o(5,"Reader notes"),i(),e(6,"p",4),o(7,"Public comments appear once approved."),i()(),e(8,"div",16),h(9,Y,8,7,"article",17),i(),e(10,"article",5)(11,"h3"),o(12,"Add a comment"),i(),e(13,"p",14),o(14,"Login required to submit."),i(),e(15,"form",8),_("submit",function(n){return c(t),m().submitComment(),d(n.preventDefault())}),e(16,"label")(17,"span"),o(18,"Name"),i(),e(19,"input",18),S("ngModelChange",function(n){c(t);let l=m();return x(l.form.author,n)||(l.form.author=n),d(n)}),i()(),e(20,"label",19)(21,"span"),o(22,"Website"),i(),e(23,"input",20),S("ngModelChange",function(n){c(t);let l=m();return x(l.form.website,n)||(l.form.website=n),d(n)}),i()(),e(24,"label")(25,"span"),o(26,"Rating (1-5)"),i(),e(27,"input",21),S("ngModelChange",function(n){c(t);let l=m();return x(l.form.rating,n)||(l.form.rating=n),d(n)}),i()(),e(28,"label")(29,"span"),o(30,"Message"),i(),e(31,"textarea",22),S("ngModelChange",function(n){c(t);let l=m();return x(l.form.message,n)||(l.form.message=n),d(n)}),i()(),e(32,"button",12),o(33,"Submit"),i(),h(34,Z,2,1,"p",15),i()()()}if(s&2){let t=m();r(9),g("ngForOf",t.comments),r(10),f("ngModel",t.form.author),r(4),f("ngModel",t.form.website),r(4),f("ngModel",t.form.rating),r(4),f("ngModel",t.form.message),r(3),g("ngIf",t.status)}}var U=class s{constructor(a,t,p,n,l){this.route=a;this.state=t;this.api=p;this.auth=n;this.seo=l}post;comments=[];status="";authStatus="";authEmail="";authPassword="";form={author:"",rating:5,message:"",website:"",ts:Date.now()};email=null;get t(){return this.state.t()}async ngOnInit(){let a=this.route.snapshot.paramMap.get("slug");this.post=this.t.blog.posts.find(t=>t.slug===a),this.updateSeo(),await this.refreshAuth(),this.post&&(await this.loadComments(this.post.slug),await this.api.trackPage(`/blog/${this.post.slug}`))}updateSeo(){let a=this.t.blog;if(!this.post){this.seo.update({title:this.seo.titleWithSite(a.title),description:a.lead,ogType:"website"}),this.seo.setJsonLd("app-jsonld",null),this.seo.setJsonLd("blog-jsonld",null);return}let t=this.seo.currentUrl();this.seo.update({title:this.seo.titleWithSite(this.post.title),description:this.post.text,ogType:"article",url:t}),this.seo.setJsonLd("app-jsonld",null),this.seo.setJsonLd("blog-jsonld",{"@context":"https://schema.org","@type":"BlogPosting",headline:this.post.title,description:this.post.text,datePublished:this.post.date,dateModified:this.post.date,author:{"@type":"Organization",name:"Steel - Command"},mainEntityOfPage:{"@type":"WebPage","@id":t},url:t})}async refreshAuth(){this.email=await this.auth.getUserEmail(),this.form.author=this.email||""}async signIn(){this.authStatus="";let a=await this.auth.signIn(this.authEmail,this.authPassword);if(a){this.authStatus=a;return}await this.refreshAuth(),this.authStatus="Signed in."}async signOut(){await this.auth.signOut(),this.email=null,this.authStatus="Signed out."}async signInWithProvider(a){this.authStatus="";let t=await this.auth.signInWithProvider(a);if(t){this.authStatus=t;return}this.authStatus="Redirecting to provider..."}async loadComments(a){try{this.comments=await this.api.getComments(a)}catch(t){this.status=t.message||"Failed to load comments"}}async submitComment(){if(this.post){this.status="";try{await this.api.postComment({page:this.post.slug,author:this.form.author||"user",rating:this.form.rating||null,message:this.form.message,email:this.email||void 0,meta:{hp:this.form.website,ts:this.form.ts}}),this.form.message="",this.form.ts=Date.now(),await this.loadComments(this.post.slug),this.status="Comment submitted for approval."}catch(a){this.status=a.message||"Failed to submit comment"}}}static \u0275fac=function(t){return new(t||s)(w(B),w(T),w(W),w(V),w(A))};static \u0275cmp=y({type:s,selectors:[["app-blog-detail"]],decls:3,vars:3,consts:[["class","section",4,"ngIf"],[1,"section"],[1,"section-head"],[1,"eyebrow"],[1,"section-lead"],[1,"panel"],[4,"ngFor","ngForOf"],[1,"list"],[1,"form",3,"submit"],["type","email","name","authEmail",3,"ngModelChange","ngModel"],["type","password","name","authPassword",3,"ngModelChange","ngModel"],[1,"form-actions"],["type","submit",1,"btn","primary"],["type","button",1,"btn","ghost",3,"click"],[1,"hint"],["class","hint",4,"ngIf"],[1,"card-grid","two"],["class","panel",4,"ngFor","ngForOf"],["type","text","name","author",3,"ngModelChange","ngModel"],[1,"honeypot"],["type","text","name","website","autocomplete","off",3,"ngModelChange","ngModel"],["type","number","min","1","max","5","name","rating",3,"ngModelChange","ngModel"],["rows","4","name","message",3,"ngModelChange","ngModel"]],template:function(t,p){t&1&&h(0,K,15,5,"section",0)(1,X,33,3,"section",0)(2,$,35,6,"section",0),t&2&&(g("ngIf",p.post),r(),g("ngIf",p.post),r(),g("ngIf",p.post))},dependencies:[P,M,I,G,j,O,R,k,F,z,J,N,L,D],encapsulation:2})};export{U as BlogDetailComponent};
