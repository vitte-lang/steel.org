import{a as W,b as N,c as F,d as O,e as D,f as L,j as V}from"./chunk-WUIIHW2R.js";import{a as T,b as k}from"./chunk-UBY4PNWH.js";import{$a as n,Ab as I,Bb as P,Cb as M,Da as y,Ha as u,Na as p,Oa as e,Pa as t,Ra as C,Sa as c,Ta as g,U as S,V as w,ab as d,cb as b,eb as h,fb as f,gb as v,kb as x,lb as A,ta as r,za as _,zb as E}from"./chunk-6FHNHJOP.js";function G(o,a){if(o&1&&(e(0,"p",11),n(1),t()),o&2){let i=g();r(),d(i.status)}}function j(o,a){if(o&1&&(e(0,"article",4)(1,"p",11),n(2),t(),e(3,"h3"),n(4),t(),e(5,"p"),n(6,"Views"),t()()),o&2){let i=a.$implicit;r(2),d(i.page),r(2),d(i.views)}}function q(o,a){if(o&1&&(e(0,"section",0)(1,"div",1)(2,"p",2),n(3,"Stats"),t(),e(4,"h2"),n(5,"Page views"),t()(),e(6,"div",14),u(7,j,7,2,"article",15),t()()),o&2){let i=g();r(7),p("ngForOf",i.stats)}}function z(o,a){if(o&1){let i=C();e(0,"article",4)(1,"p",11),n(2),x(3,"date"),t(),e(4,"h3"),n(5),t(),e(6,"p"),n(7),t(),e(8,"button",17),c("click",function(){let l=S(i).$implicit,m=g(2);return w(m.approve(l.id))}),n(9,"Approve"),t()()}if(o&2){let i=a.$implicit;r(2),b("",A(3,4,i.created_at,"mediumDate")," \xB7 ",i.page),r(3),d(i.author),r(2),d(i.message)}}function H(o,a){if(o&1&&(e(0,"section",0)(1,"div",1)(2,"p",2),n(3,"Moderation"),t(),e(4,"h2"),n(5,"Pending comments"),t()(),e(6,"div",16),u(7,z,10,7,"article",15),t()()),o&2){let i=g();r(7),p("ngForOf",i.comments)}}var B=class o{constructor(a,i){this.auth=a;this.api=i}email="";password="";status="";stats=[];comments=[];hasAccess=!1;async ngOnInit(){await this.refresh()}async login(){this.status="";let a=await this.auth.signIn(this.email,this.password);if(a){this.status=a;return}await this.refresh()}async resetPassword(){if(this.status="",!this.email){this.status="Enter your email first.";return}let a=await this.auth.resetPassword(this.email);this.status=a||"Password reset email sent."}async logout(){await this.auth.signOut(),this.stats=[],this.comments=[],this.hasAccess=!1}async signInWithProvider(a){this.status="";let i=await this.auth.signInWithProvider(a);if(i){this.status=i;return}this.status="Redirecting to provider..."}async refresh(){try{this.stats=await this.api.getStatsAdmin(),this.comments=await this.api.getCommentsAdmin(),this.hasAccess=!0}catch(a){this.status=a.message||"Login required",this.hasAccess=!1}}async approve(a){this.status="";try{await this.api.approveComment(a),await this.refresh()}catch(i){this.status=i.message||"Approval failed"}}static \u0275fac=function(i){return new(i||o)(_(T),_(k))};static \u0275cmp=y({type:o,selectors:[["app-admin"]],decls:37,vars:5,consts:[[1,"section"],[1,"section-head"],[1,"eyebrow"],[1,"section-lead"],[1,"panel"],[1,"form",3,"submit"],["type","email","name","email",3,"ngModelChange","ngModel"],["type","password","name","password",3,"ngModelChange","ngModel"],[1,"form-actions"],["type","submit",1,"btn","primary"],["type","button",1,"btn","ghost",3,"click"],[1,"hint"],["class","hint",4,"ngIf"],["class","section",4,"ngIf"],[1,"card-grid","three"],["class","panel",4,"ngFor","ngForOf"],[1,"card-grid","two"],["type","button",1,"btn","primary",3,"click"]],template:function(i,s){i&1&&(e(0,"section",0)(1,"div",1)(2,"p",2),n(3,"Admin"),t(),e(4,"h2"),n(5,"Moderation & stats"),t(),e(6,"p",3),n(7,"Login required to manage comments and stats."),t()(),e(8,"article",4)(9,"form",5),c("submit",function(m){return s.login(),m.preventDefault()}),e(10,"label")(11,"span"),n(12,"Email"),t(),e(13,"input",6),v("ngModelChange",function(m){return f(s.email,m)||(s.email=m),m}),t()(),e(14,"label")(15,"span"),n(16,"Password"),t(),e(17,"input",7),v("ngModelChange",function(m){return f(s.password,m)||(s.password=m),m}),t()(),e(18,"div",8)(19,"button",9),n(20,"Login"),t(),e(21,"button",10),c("click",function(){return s.logout()}),n(22,"Logout"),t(),e(23,"button",10),c("click",function(){return s.resetPassword()}),n(24,"Forgot password"),t()(),e(25,"p",11),n(26,"Or continue with"),t(),e(27,"div",8)(28,"button",10),c("click",function(){return s.signInWithProvider("github")}),n(29,"GitHub"),t(),e(30,"button",10),c("click",function(){return s.signInWithProvider("google")}),n(31,"Google"),t(),e(32,"button",10),c("click",function(){return s.signInWithProvider("azure")}),n(33,"Microsoft"),t()(),u(34,G,2,1,"p",12),t()()(),u(35,q,8,1,"section",13)(36,H,8,1,"section",13)),i&2&&(r(13),h("ngModel",s.email),r(4),h("ngModel",s.password),r(17),p("ngIf",s.status),r(),p("ngIf",s.hasAccess),r(),p("ngIf",s.hasAccess))},dependencies:[M,E,I,V,L,W,N,F,D,O,P],encapsulation:2})};export{B as AdminComponent};
